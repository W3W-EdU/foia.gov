name: Deploy to dev environment - dev-www.foia.gov
on:
  push:
    branches:
      - dev-test
jobs:
  # Build for the Acquia Cloud development environment
  build:
    env: 
      GIT_REPO: ${{ secrets.GIT_REPO }}
      NODE_ENV: production
      APP_ENV: development
    runs-on: ubuntu-20.04
    steps:
#       # Setting up node
#       - uses: actions/checkout@v3
#       - uses: actions/setup-node@v3
#       - name: Setting up NODE 16
#         env:
#           NODE_ENV: production
#           APP_ENV: development
# 
#         with:
#           node-version: 16
#           cache: 'npm'
#         run: |
#           node -v #npm i did not work here
      # Setup RUBY and install openssl
      - uses: actions/checkout@v3
#      - uses: ruby/setup-ruby@8a6667e214803d030def654bc64a71ceeec500d1
      - name: Setup RUBY
        uses: ruby/setup-ruby@v1
      - name: Install dependencies
        run: | 
          npm i
          bundle install
      # Install SSH Key
      # https://github.com/marketplace/actions/webfactory-ssh-agent
      - name: Install SSH key
        uses: webfactory/ssh-agent@v0.7.0
        with:
          ssh-private-key: ${{ secrets.SSH_KEY }}
#       - name: Acquia known hosts
#         run: |
#           echo "${{ secrets.KNOWN_HOSTS }}" >> ~/.ssh/known_hosts
      # Install NPM pacakges and build the static site
      - name: Install npm packages
        run: |
          npm i
      - name: Building front end site
        run: |
          make build
#       - name: Run tests
#         run: make test
      - name: Deploy to Acquia development
        run: sh bin/git-deploy.sh _site dev-test
        
        
